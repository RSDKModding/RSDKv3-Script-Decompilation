//------------Sonic CD Time Warp Fix Script-------------//
//--------Scripted by Christian Whitehead 'The Taxman'--------//
//-------Unpacked By Rubberduckycooly's Script Unpacker-------//

// Aliases
#alias Object.Value0	:	Object.DissapearTimer
// States
#alias 0	:	TIMEWARPFIX_ERASE_TOUCH		// Touch this, no more warp for you
#alias 1	:	TIMEWARPFIX_ERASE_AREA		// Get past this, no more warp for you
#alias 2	:	TIMEWARPFIX_SAVE_POINT		// tldr, sets your position to the next object after time-travelling
#alias 3	:	TIMEWARPFIX_SAVE_POINT_AIRT	// tldr, sets your position to the next object after time-travelling, but in the air

// Gravity
#alias 1	:	GRAVITY_AIR

sub ObjectMain
	switch Object.PropertyValue
	case TIMEWARPFIX_ERASE_TOUCH
		PlayerObjectCollision(C_TOUCH, -16, -16, 16, 16)
		if CheckResult == true
			if Warp.Destination > 0
				if Warp.Timer > 99
					if Warp.Timer < 220
						Warp.Destination = 0
					end if
				end if
				Warp.Timer = 0
			end if
		end if
		break

	case TIMEWARPFIX_ERASE_AREA
		if Player.XPos < Object.XPos
			Warp.Destination = 0
			Warp.Timer = 0
		end if
		break

	case TIMEWARPFIX_SAVE_POINT
		PlayerObjectCollision(C_TOUCH, -48, -48, 48, 48)
		if CheckResult == true
			Object.Type = TypeName[BlankObject]
			Player.XPos = Object[+1].XPos
			Player.YPos = Object[+1].YPos
		end if
		Object.DissapearTimer++
		if Object.DissapearTimer == 2
			Object.Type = TypeName[BlankObject]
		end if
		break

	case TIMEWARPFIX_SAVE_POINT_AIR
		PlayerObjectCollision(C_TOUCH, -96, -96, 96, 96)
		if CheckResult == true
			Object.Type = TypeName[BlankObject]
			Player.XPos = Object[+1].XPos
			Player.YPos = Object[+1].YPos
			Player.Gravity = GRAVITY_AIR
		end if
		Object.DissapearTimer++
		if Object.DissapearTimer == 2
			Object.Type = TypeName[BlankObject]
		end if
		break
		
	end switch
end sub


sub ObjectPlayerInteraction
	PlayerObjectCollision(C_TOUCH, -14, -15, 14, 16)
end sub


sub RSDKEdit
	if Editor.ReturnVariable == true
		switch Editor.VariableID
		case EDIT_VAR_PROPVAL // property value
			CheckResult = Object.PropertyValue
			break
		case 0 // type
			CheckResult = Object.PropertyValue
			break
		end switch
	else
		switch Editor.VariableID
		case EDIT_VAR_PROPVAL // property value
			Object.PropertyValue = Editor.VariableValue
			break
		case 0 // type
			Object.PropertyValue = Editor.VariableValue
			break
		end switch
	end if
end sub


sub RSDKDraw
	DrawSprite(0)
end sub


sub RSDKLoad
	LoadSpriteSheet("Global/Display.gif")
	SpriteFrame(-16, -16, 32, 32, 1, 143)

	AddEditorVariable("type")
	SetActiveVariable("type")
	AddEnumVariable("Erase - Touch", 0)
	AddEnumVariable("Erase - Area", 1)
	AddEnumVariable("Save Point - Normal", 2)
	AddEnumVariable("Save Point - Air", 3)
end sub
