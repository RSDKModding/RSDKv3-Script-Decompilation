//------------Sonic CD Attract Mode Script-------------//
//--------Scripted by Christian Whitehead 'The Taxman'--------//
//-------Unpacked By Rubberduckycooly's Script Unpacker-------//

// Aliases
#alias Object.Value1	:	Object.DemoTime
#alias Object.Value2	:	Object.DemoDuration
#alias Object.Value3	:	Object.DemoInput

// States
#alias 0				:	ATTRACTMODE_SETUP
#alias 1				:	ATTRACTMODE_HANDLE_INPUT

// Engine & CallBacks
#alias 2 				:	MESSAGE_LOSTFOCUS

sub ObjectMain
	switch Object.State
	case ATTRACTMODE_SETUP
		if Player.ControlMode == 0
			Object.State++
			Object.DemoInput = Object.DemoDuration
			Object.DemoInput -= 60
		end if
		break

	case ATTRACTMODE_HANDLE_INPUT
		GetTextInfo(TempValue0, MENU_1, 0, 0, Object.DemoTime)
		GetBit(Player.Up, TempValue0, 0)
		GetBit(Player.Down, TempValue0, 1)
		GetBit(Player.Left, TempValue0, 2)
		GetBit(Player.Right, TempValue0, 3)
		GetBit(Player.JumpPress, TempValue0, 4)
		GetBit(Player.JumpHold, TempValue0, 5)
		if Object.DemoTime < Object.DemoDuration
			Object.DemoTime++
		else
			StopMusic()
			Options.AttractMode = false
			Stage.ActiveList = PRESENTATION_STAGE
			Stage.ListPos = 0		// Title Screen
			Transporter_Destroyed = 0
			MetalSonic_Destroyed = 0
			Good_Future = 0
			LoadStage()
			LampPost.Check = 0

#platform: Use_Haptics
			Engine.HapticsEnabled = SaveRAM[40]
#endplatform
		end if

		if Object.DemoTime >= Object.DemoInput
			Music.Volume -= 2
			Screen.CameraEnabled = 0
			TempValue0 = Object.DemoTime
			TempValue0 -= Object.DemoInput
			TempValue0 <<= 3
			if TempValue0 > 255
				TempValue0 = 255
			end if
			SetScreenFade(0, 0, 0, TempValue0)
		else
			if KeyPress.ButtonA == true
				Object.DemoTime = Object.DemoInput
			end if
			if KeyPress.ButtonB == true
				Object.DemoTime = Object.DemoInput
			end if
			if KeyPress.ButtonC == true
				Object.DemoTime = Object.DemoInput
			end if
			if KeyPress.AnyStart == true
				Object.DemoTime = Object.DemoInput
			end if

#platform: Mobile
			CheckTouchRect(0, 0, Screen.XSize, 240)
			if CheckResult > -1
				Object.DemoTime = Object.DemoInput
			end if
			if Engine.Message == MESSAGE_LOSTFOCUS
				Object.DemoTime = Object.DemoInput
			end if
#endplatform

		end if
		break
	end switch
end sub


sub ObjectDraw
	if Object[20].Type != TypeName[TitleCard]
		Object.AnimationTimer++
		Object.AnimationTimer %= 60
		if Object.AnimationTimer > 29
		end if
	end if
end sub


sub ObjectStartup
	if Stage.ActiveList == REGULAR_STAGE
		if Stage.PlayerListPos == 0		// PlayerName[SONIC]
			LoadSpriteSheet("Global/Display.gif")
		else
			LoadSpriteSheet("Global/Display_t.gif")
		end if
		
		SpriteFrame(-17, -5, 34, 11, 1, 176)		// #0 Demo (Unused)
	else
		LoadSpriteSheet("Special/Objects.gif")

		SpriteFrame(-17, -5, 34, 11, 83, 168)		// #0 Demo (Unused)
	end if

	ArrayPos0 = 32
	while ArrayPos0 < 1056
		if Object[ArrayPos0].Type == TypeName[AttractMode]
			if Options.AttractMode == true
				Object[ArrayPos0].Priority = 1
				Object[ArrayPos0].DrawOrder = 6
				switch Object[ArrayPos0].PropertyValue
				case 0
					LoadTextFile(MENU_1, "Data/Game/Demos/Key11a.bin", 0)
					LampPost.Check = 0
					break
				case 1
					LoadTextFile(MENU_1, "Data/Game/Demos/Special1.bin", 0)
					LampPost.Check = 0
					break
				case 2
					LoadTextFile(MENU_1, "Data/Game/Demos/Key43c.bin", 0)
					Player.XPos = Object[ArrayPos0].XPos
					Player.YPos = Object[ArrayPos0].YPos
					LampPost.Check = 33
					break
				case 3
					LoadTextFile(MENU_1, "Data/Game/Demos/Special6.bin", 0)
					LampPost.Check = 0
					break
				case 4
					LoadTextFile(MENU_1, "Data/Game/Demos/Key82a.bin", 0)
					Player.XPos = Object[ArrayPos0].XPos
					Player.YPos = Object[ArrayPos0].YPos
					LampPost.Check = 33
					break
				end switch
				GetTextInfo(Object[ArrayPos0].Value2, MENU_1, 1, 0, 0)
			else
				Object[ArrayPos0].Type = TypeName[BlankObject]
			end if
		end if
		ArrayPos0++
	loop
end sub


sub RSDKDraw
	DrawSprite(0)
end sub


sub RSDKLoad
	LoadSpriteSheet("Global/Display.gif")
	SpriteFrame(-16, -16, 32, 32, 1, 143)

	SetVariableAlias(ALIAS_VAR_PROPVAL, "unused")
end sub

